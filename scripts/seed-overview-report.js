/* eslint-disable @typescript-eslint/no-require-imports */
const { PrismaClient } = require('@prisma/client');

const prisma = new PrismaClient();

async function main() {
    console.log('Seeding Project Overview Report...');

    const reportContent = `
# Project Overview: Architecture & Health Assessment

**Generated by:** Antigravity AI (Manual Fallback)
**Date:** ${new Date().toLocaleDateString()}

## 1. Executive Summary
The system landscape is currently in a **transitional phase**. While the core dashboard (Next.js 16) is modern and performant, the backend services (Python) and dependency management show signs of fragmentation. The overall health is **stable but requires attention** to prevent technical debt accumulation.

## 2. Portfolio Statistics
- **Total Repositories:** 57 detected.
- **Technology Stack:**
    - **Frontend:** Next.js, React, Tailwind CSS, Tremor.
    - **Backend:** Python (Flask/FastAPI), Node.js.
    - **Infrastructure:** Vercel, Fly.io, Supabase, Cloudflare.
- **Deployment Health:** 31 active deployments detected.

## 3. Critical Risks
> [!WARNING]
> **Immediate Action Required**

1.  **Outdated Dependencies**: The \`playlist_generator\` and potentially other Python services have not been updated in >180 days. This increases vulnerability to security exploits.
2.  **Secret Management**: Detection of keys like \`OPENAI_API_KEY\` in environment analysis suggests a need for a centralized secret management solution (e.g., Vault or Infisical) rather than relying solely on \`.env\` files across multiple repos.
3.  **Public/Private Visibility**: 57 repos were scanned. A strict audit is needed to ensure no internal logic is exposed in public repositories.

## 4. Strategic Recommendations (Next Steps)

### Phase 1: Stabilization (Weeks 1-2)
-   **Standardize CI/CD**: Implement a shared GitHub Actions workflow for all repos to enforce linting, testing, and security scanning on every push.
-   **Dependency Audit**: Run \`npm audit\` and \`pip check\` across all projects and fix high-severity vulnerabilities.

### Phase 2: Modernization (Weeks 3-6)
-   **Unified API Gateway**: Consider placing a gateway (e.g., Kong or a Next.js Middleware) in front of the disparate Python and Node services to unify authentication and logging.
-   **Infrastructure as Code (IaC)**: Move manual Vercel/Fly.io configurations into Terraform or Pulumi to ensure reproducibility.

### Phase 3: Automation (Ongoing)
-   **Automated Reporting**: Convert this manual report into a weekly automated email sent to the engineering team.
-   **Self-Healing**: Implement scripts that can automatically restart stuck services or rollback failed deployments.
`;

    await prisma.aIReport.create({
        data: {
            content: reportContent,
            createdAt: new Date()
        }
    });

    console.log('âœ… Project Overview seeded successfully.');
}

main()
    .catch((e) => {
        console.error(e);
        process.exit(1);
    })
    .finally(async () => {
        await prisma.$disconnect();
    });
